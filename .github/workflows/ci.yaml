name: Sample GitHub Action Workflow

# Concepts
# Workflow -> Jobs -> Steps
# Tiggered by 'on's
# Can have input variables
# Can read/write GH Secrets and Variables
# Can have local variables at multiple levels
# Can pass job outputs to job inputs
# Can pass artifacts
# Can output stuff at the end
# * look at cache
# * look at matrix
# * look at conditionals


on:
    workflow_dispatch:
        inputs:
            inVersion:
                description: 'the version'
                required: true
                type: string
                default: ''
            inName:
                description: 'your name'
                required: false
                type: string
                default: 'derek'

# ENV Vars can be at top level, job level, or step level
env: 
  WF_ENV_VAR: WorkflowEnvVarValue

jobs:
    Display-inputs:
        runs-on: ubuntu-latest
        permissions:
            actions: none # none | read | write permission for GITHUB_TOLKEN
        steps:
            - name: Display User Inputs
              id: display-user-inputs
              run: |
                echo "User Inputs:"
                echo "${{ toJSON(github.event.inputs) }}"

    in-and-out:
        runs-on: ubuntu-latest
        needs: Display-inputs
        outputs:
            OUTPUT1: ${{ steps.set-outputs.outputs.JUMPERBOX_IP }}
        env:
          JOB_ENV_VAR: JobEnvVarValue
        steps:
            - uses: actions/checkout@v4
              env:
                STEP_ENV_VAR: StepEnvVarValue
            - name: Display Variables
              id: display-version-inputs
              run: |
                echo "### INPUTS ###"
                echo "Version input: ${{inputs.inVersion}}"
                echo "Name input: ${{inputs.inName}}"
                
                echo "### ENV ###"
                echo "Workflow ENV: $WF_ENV_VAR
                echo "Job ENV: $JOB_ENV_VAR
                echo "Step ENV: $STEP_ENV_VAR

                # echo "$GITHUB_ENV"
                # cat "$GITHUB_ENV"
                echo ${{vars.TEST_VAR}}
                gh variable set TEST_VAR --body "${{vars.TEST_VAR}} +update"
                echo ${{secrets.GITHUB_TOKEN}}
                # env
            - name: Set an environment variable
              run: echo "MY_VARIABLE=Hello from job1" >> $GITHUB_ENV
            - name: Use the environment variable
              run: echo "The variable is $MY_VARIABLE"
            - name: Set Outputs
              id: set-outputs
              run: |
                  echo "JUMPERBOX_IP=HOSTNAME" >> $GITHUB_OUTPUT
            - name: Create an output file
              run: echo "This is my final output" > output.txt
            - name: Upload output file
              uses: actions/upload-artifact@v4
              with:
                name: output-file
                path: output.txt

    final-step:
        runs-on: ubuntu-latest
        needs: in-and-out
        steps:
            - name: Display User Inputs
              id: display-user-inputs
              run: |
                echo "Output1: ${{needs.in-and-out.outputs.OUTPUT1}}"
            - name: Download output file
              uses: actions/download-artifact@v4
              with:
                name: output-file
                path: output
            - name: Display the output file
              run: |
                echo "Output file: "
                cat output/output.txt
            - name: Set the Summary
              if: always()
              id: set-step-summary
              run: |
                echo "Best regards," >> $GITHUB_STEP_SUMMARY
                
